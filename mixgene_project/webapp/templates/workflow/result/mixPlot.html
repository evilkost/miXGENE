{% load static %}

<!-- expecting django variable  result -->

<!-- script language="javascript" type="text/javascript" src="{% static 'js/flot_ajax_2d_scatter.js' %}"></script -->

<div class="panel panel-default">
    <div class="panel-heading"><h3>{{ result.title }}</h3></div>
    <div class="panel-body demo-container">
        <!-- a id="flot_source" class="hidden" href="{% url 'get_flot_2d_scatter'  exp.pk result.filename %}" >points</a -->
        <div id="{{ result.uuid }}_plot" class="demo-placeholder">

        </div>
    </div>

    <script type="text/javascript" >
        $(function() {
            var options = {
                lines: {
                    show: false
                },
                points: {
                    show: true
                }
            };

            var data = [];
            $.plot("#{{ result.uuid }}_plot", data, options);

            // Fetch one series, adding to what we already have
            var alreadyFetched = {};
            $(document).ready(function () {
                var button = $(this);
                // Find the URL in the link right next to us, then fetch the data

                var dataurl = '{% url 'get_flot_2d_scatter'  exp.pk result.filename %}';

                function onDataReceived(response) {
                    // Extract the first coordinate pair; jQuery has parsed it, so
                    // the data is now just an ordinary JavaScript object

                    series_list = response['series_list']
                    // Push the new data onto our existing data array
                    $.each(series_list, function(idx, series){
                        if (!alreadyFetched[series.label]) {
                            alreadyFetched[series.label] = true;
                            data.push(series);
                        }
                    });
                    $.plot("#{{ result.uuid }}_plot", data, options);
                }

                $.ajax({
                    url: dataurl,
                    type: "GET",
                    dataType: "json",
                    success: onDataReceived
                });
            });


        });

    </script>
</div>
